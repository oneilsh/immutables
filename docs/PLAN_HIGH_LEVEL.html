<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CRAN Cleanup Plan — High-Level • immutables</title><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="CRAN Cleanup Plan — High-Level"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">immutables</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="articles/flexseq.html">Getting Started with flexseq</a></li>
    <li><a class="dropdown-item" href="articles/priority-queues.html">Priority Queues</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item"><a class="nav-link" href="https://github.com/oneilsh/immutables/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CRAN Cleanup Plan — High-Level</h1>
      <small class="dont-index">Source: <a href="https://github.com/oneilsh/immutables/blob/HEAD/PLAN_HIGH_LEVEL.md"><code>PLAN_HIGH_LEVEL.md</code></a></small>
    </div>

<div id="cran-cleanup-plan--high-level" class="section level1">

<div class="section level2">
<h2 id="id_1-fix-all-examples-blocks">1. Fix all <code>@examples</code> blocks<a class="anchor" aria-label="anchor" href="#id_1-fix-all-examples-blocks"></a></h2>
<p><strong>Problem:</strong> Many examples reference non-exported functions (<code>MeasureMonoid()</code>, <code><a href="reference/tree_from.html">tree_from()</a></code>, <code>Predicate()</code>) causing <code>R CMD check</code> failures. The pkgdown site already shows these errors.</p>
<p><strong>Approach:</strong></p>
<ul><li>Replace <code>MeasureMonoid(...)</code> with <code>measure_monoid(...)</code> in all roxygen <code>@examples</code>.</li>
<li>Replace <code>tree_from(...)</code> with <code>as_flexseq(...)</code> (the public equivalent).</li>
<li>Replace <code>Predicate(...)</code> with <code>predicate(...)</code> if present in examples.</li>
<li>Review all <code>@examples</code> in exported functions for simplicity and correctness. Use only exported, user-facing API calls. Examples should demonstrate canonical usage — straightforward and self-contained.</li>
<li>For <code>@keywords internal</code> functions (<code>empty_tree</code>, <code>concat_trees</code>, <code>plot_tree</code>, <code>get_graph_df</code>): wrap examples in <code>\dontrun{}</code> since these aren’t part of the public API, or replace with examples using exported functions where possible.</li>
<li>After edits, run <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenise()</a></code> to regenerate <code>man/</code> pages and NAMESPACE.</li>
</ul></div>
<div class="section level2">
<h2 id="id_2-clean-up-developer-api-exports-vs-internals">2. Clean up developer API exports vs internals<a class="anchor" aria-label="anchor" href="#id_2-clean-up-developer-api-exports-vs-internals"></a></h2>
<p><strong>Problem:</strong> Several exported S3 methods dispatch on <code>FingerTree</code> (an internal class), and several <code>@keywords internal</code> functions appear in the pkgdown developer API section despite not being exported. The public API should operate on <code>flexseq</code> / <code>priority_queue</code> objects only.</p>
<p><strong>Approach:</strong></p>
<ul><li>
<code><a href="reference/tree_from.html">tree_from()</a></code>, <code><a href="reference/empty_tree.html">empty_tree()</a></code>, <code><a href="reference/concat_trees.html">concat_trees()</a></code> are already <code>@keywords internal</code> and not exported — no NAMESPACE changes needed. Ensure their examples use <code>\dontrun{}</code> or are removed.</li>
<li>
<code><a href="reference/get_graph_df.html">get_graph_df()</a></code> and <code><a href="reference/plot_tree.html">plot_tree()</a></code> are <code>@keywords internal</code> — same treatment.</li>
<li>The <code>_pkgdown.yml</code> developer API section references unexported functions. Remove them from pkgdown config or accept that pkgdown can document internal functions (they just won’t be user-accessible without <code>:::</code>).</li>
<li>S3 methods registered on <code>FingerTree</code> (<code>[.FingerTree</code>, <code>[[.FingerTree</code>, etc.) already have corresponding <code>flexseq</code> registrations in NAMESPACE — verify the flexseq methods dispatch correctly and that users always interact via <code>flexseq</code>.</li>
</ul></div>
<div class="section level2">
<h2 id="id_3-remove-lazydata-true">3. Remove <code>LazyData: true</code>
<a class="anchor" aria-label="anchor" href="#id_3-remove-lazydata-true"></a></h2>
<p><strong>Problem:</strong> DESCRIPTION has <code>LazyData: true</code> but no <code>data/</code> directory, producing an <code>R CMD check</code> NOTE.</p>
<p><strong>Approach:</strong> Remove the <code>LazyData: true</code> line from DESCRIPTION.</p>
</div>
<div class="section level2">
<h2 id="id_4-resolve-split-and-append-base-r-masking">4. Resolve <code>split</code> and <code>append</code> base R masking<a class="anchor" aria-label="anchor" href="#id_4-resolve-split-and-append-base-r-masking"></a></h2>
<div class="section level3">
<h3 id="split-clean-solution-available">
<code>split</code> (clean solution available)<a class="anchor" aria-label="anchor" href="#split-clean-solution-available"></a></h3>
<p><code><a href="https://rdrr.io/r/base/split.html" class="external-link">base::split</a></code> is an S3 generic. Convert the current standalone <code><a href="https://rdrr.io/r/base/split.html" class="external-link">split()</a></code> export to a proper <code>split.flexseq</code> S3 method.</p>
<p><strong>Current signature:</strong> <code>split(t, predicate, monoid_name)</code> <strong>New signature:</strong> <code>split.flexseq(x, f, ...)</code></p>
<p>Where <code>x</code> is the flexseq tree, <code>f</code> is the predicate function, and <code>monoid_name</code> is passed via <code>...</code> (positionally or as a named argument). The method is registered via <code>@method split flexseq</code> / <code>S3method(split, flexseq)</code> in NAMESPACE.</p>
<p>Update call sites in tests: <code>split(t, pred, ".size")</code> continues to work unchanged since R dispatches on the first argument’s class.</p>
</div>
<div class="section level3">
<h3 id="append-decided-s3-generic-with-default-fallback">
<code>append</code> (decided: S3 generic with default fallback)<a class="anchor" aria-label="anchor" href="#append-decided-s3-generic-with-default-fallback"></a></h3>
<p><code><a href="https://rdrr.io/r/base/append.html" class="external-link">base::append</a></code> is NOT a generic — it’s a plain function. We create our own S3 generic: <code>append &lt;- function(x, ...) UseMethod("append")</code>, provide <code>append.default</code> forwarding to <code>base::append(x, ...)</code>, and <code>append.flexseq</code> wrapping the current implementation. This is a well-established CRAN pattern (e.g. how <code>data.table</code> handles <code>merge</code>). Users get clean <code>append(t, x)</code> semantics and <code><a href="https://rdrr.io/r/base/append.html" class="external-link">base::append()</a></code> still works on non-flexseq objects.</p>
<p>Update all tests and examples to reflect any signature changes.</p>
</div>
</div>
<div class="section level2">
<h2 id="id_5-move-igraph-from-imports-to-suggests">5. Move <code>igraph</code> from Imports to Suggests<a class="anchor" aria-label="anchor" href="#id_5-move-igraph-from-imports-to-suggests"></a></h2>
<p><strong>Problem:</strong> <code>igraph</code> (~5MB compiled) is used only in <code><a href="reference/plot_tree.html">plot_tree()</a></code>, which is <code>@keywords internal</code>.</p>
<p><strong>Approach:</strong></p>
<ul><li>Move <code>igraph</code> from <code>Imports</code> to <code>Suggests</code> in DESCRIPTION.</li>
<li>Remove <code>@import igraph</code> from <code>R/fingertree-package.R</code>.</li>
<li>In <code><a href="reference/plot_tree.html">plot_tree()</a></code> (<code>R/utils.R</code>), add a <code><a href="https://r.igraph.org/" class="external-link">requireNamespace("igraph")</a></code> guard with a helpful error message if not installed.</li>
<li>Qualify igraph function calls: <code><a href="https://r.igraph.org/reference/graph_from_data_frame.html" class="external-link">igraph::graph_from_data_frame()</a></code>, <code><a href="https://r.igraph.org/reference/layout_as_tree.html" class="external-link">igraph::layout_as_tree()</a></code>, <code><a href="https://r.igraph.org/reference/V.html" class="external-link">igraph::V()</a></code>, <code><a href="https://r.igraph.org/reference/gorder.html" class="external-link">igraph::vcount()</a></code>.</li>
<li>Remove <code>import(igraph)</code> from NAMESPACE (will happen automatically via <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenise()</a></code>).</li>
</ul></div>
<div class="section level2">
<h2 id="id_6-eliminate-rlist-dependency">6. Eliminate <code>rlist</code> dependency<a class="anchor" aria-label="anchor" href="#id_6-eliminate-rlist-dependency"></a></h2>
<p><strong>Problem:</strong> Only 3 usages of <code>rlist</code> functions (<code>list.prepend</code>, <code>list.append</code>), used to prepend/append an element to a list while preserving flat structure.</p>
<p><strong>Approach:</strong> Replace with base R equivalents that satisfy the stated requirements (prepend/append element to list without nesting, then restore class attributes):</p>
<ul><li>
<code>list.prepend(d, el)</code> → <code>c(list(el), d)</code> (in <code>R/add_left.R</code> and <code>R/utils.R</code>)</li>
<li>
<code>list.append(d, el)</code> → <code>c(d, list(el))</code> (in <code>R/add_right.R</code>)</li>
</ul><p>The surrounding code already restores class attributes after these calls, so the replacement is safe.</p>
<p>Remove <code>rlist</code> from DESCRIPTION Imports and <code>@import rlist</code> from <code>R/fingertree-package.R</code>.</p>
</div>
<div class="section level2">
<h2 id="id_7-add-meta-to-rbuildignore">7. Add <code>meta/</code> to <code>.Rbuildignore</code>
<a class="anchor" aria-label="anchor" href="#id_7-add-meta-to-rbuildignore"></a></h2>
<p><strong>Problem:</strong> Development files in <code>meta/</code> would be included in the CRAN tarball.</p>
<p><strong>Approach:</strong> Add <code>^meta$</code> and <code>^meta/</code> patterns to <code>.Rbuildignore</code>.</p>
</div>
<div class="section level2">
<h2 id="id_8-readme--deferred">8. README — deferred<a class="anchor" aria-label="anchor" href="#id_8-readme--deferred"></a></h2>
<p>User will work on README separately. No changes in this plan.</p>
</div>
<div class="section level2">
<h2 id="id_9-add-bugreports-to-description">9. Add <code>BugReports</code> to DESCRIPTION<a class="anchor" aria-label="anchor" href="#id_9-add-bugreports-to-description"></a></h2>
<p><strong>Approach:</strong> Add <code>BugReports: https://github.com/oneilsh/immutables/issues</code> to DESCRIPTION.</p>
</div>
<div class="section level2">
<h2 id="id_10-lambdar-dependency--deferred">10. <code>lambda.r</code> dependency — deferred<a class="anchor" aria-label="anchor" href="#id_10-lambdar-dependency--deferred"></a></h2>
<p>Deeply embedded (277 occurrences across 20 files). Removing it is a large refactor that is out of scope for this round.</p>
</div>
<div class="section level2">
<h2 id="id_11-pkgdown-title--already-fixed-by-user">11. pkgdown title — already fixed by user<a class="anchor" aria-label="anchor" href="#id_11-pkgdown-title--already-fixed-by-user"></a></h2>
<p>No action needed.</p>
</div>
<div class="section level2">
<h2 id="id_12-remove-predicate-pascalcase-alias">12. Remove <code>Predicate</code> (PascalCase alias)<a class="anchor" aria-label="anchor" href="#id_12-remove-predicate-pascalcase-alias"></a></h2>
<p><strong>Problem:</strong> <code>Predicate()</code> is an unexported alias for the exported <code><a href="reference/predicate.html">predicate()</a></code>. Only referenced in one test (<code>test-cpp-parity.R:79</code>).</p>
<p><strong>Approach:</strong></p>
<ul><li>Remove the <code>Predicate</code> function definition from <code>R/Predicate.R</code> (keep <code>predicate</code>).</li>
<li>Update the test in <code>test-cpp-parity.R</code> to use <code><a href="reference/predicate.html">predicate()</a></code> instead.</li>
<li>Similarly, <code>MeasureMonoid</code> in <code>R/MeasureMonoid.R:25</code> is an unexported alias for <code>measure_monoid</code>. Remove the alias function. Update any internal code or tests that reference <code>MeasureMonoid()</code> to use <code><a href="reference/measure_monoid.html">measure_monoid()</a></code>.</li>
</ul></div>
<div class="section level2">
<h2 id="id_13-remove-placeholder-file-rfingertree_measuredr">13. Remove placeholder file <code>R/fingertree_measured.R</code>
<a class="anchor" aria-label="anchor" href="#id_13-remove-placeholder-file-rfingertree_measuredr"></a></h2>
<p><strong>Problem:</strong> File contains only a TODO comment.</p>
<p><strong>Approach:</strong> Delete <code>R/fingertree_measured.R</code>.</p>
</div>
<div class="section level2">
<h2 id="id_14-create-minimal-vignette-scaffolding">14. Create minimal vignette scaffolding<a class="anchor" aria-label="anchor" href="#id_14-create-minimal-vignette-scaffolding"></a></h2>
<p><strong>Problem:</strong> No vignettes exist. CRAN submission benefits from at least a getting-started guide.</p>
<p><strong>Approach:</strong></p>
<ul><li>Create <code>vignettes/</code> directory.</li>
<li>Create two minimal <code>.Rmd</code> vignettes:
<ul><li>
<code>vignettes/flexseq.Rmd</code> — basic flexseq usage (construction, indexing, append/prepend, fold, concatenation).</li>
<li>
<code>vignettes/priority-queues.Rmd</code> — basic priority queue usage (construction, insert, peek/extract min/max).</li>
</ul></li>
<li>Add <code>knitr</code> and <code>rmarkdown</code> to <code>Suggests</code> in DESCRIPTION.</li>
<li>Add <code>VignetteBuilder: knitr</code> to DESCRIPTION.</li>
<li>Content should be minimal/placeholder — user will flesh out later.</li>
</ul></div>
<div class="section level2">
<h2 id="execution-order">Execution order<a class="anchor" aria-label="anchor" href="#execution-order"></a></h2>
<ol style="list-style-type: decimal"><li>Items 3, 7, 9, 13 — trivial DESCRIPTION/.Rbuildignore fixes</li>
<li>Item 12 — remove PascalCase aliases</li>
<li>Item 6 — eliminate <code>rlist</code> dependency</li>
<li>Item 5 — move <code>igraph</code> to Suggests</li>
<li>Item 4 — convert <code>split</code>/<code>append</code> to proper S3 methods</li>
<li>Item 1 — fix all <code>@examples</code>
</li>
<li>Item 2 — clean up pkgdown config and internal docs</li>
<li>Item 14 — create vignette scaffolding</li>
<li>Run <code><a href="https://roxygen2.r-lib.org/reference/roxygenize.html" class="external-link">roxygen2::roxygenise()</a></code>, <code>R CMD check</code>, fix any remaining issues</li>
</ol></div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Shawn T. O’Neil.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer></div>





  </body></html>

